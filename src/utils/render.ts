// 纯手写 SVG,无需依赖任何库
import { BASE_URL } from "../config.js";
import { AILUNTZ_AVATAR_URL } from "./avatar.js";

interface VisitRecord {
  count: number;
  time: string;
  country?: string;
  city?: string;
  ip?: string;
}

function formatTime(time: string): string {
  const date = new Date(time);
  const now = new Date();
  const diff = now.getTime() - date.getTime();
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);

  if (seconds < 60) return "just now";
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days < 7) return `${days}d ago`;

  return date.toLocaleString("en-US", {
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });
}

function formatLocation(country?: string, city?: string): string {
  if (!country && !city) return "";
  if (country === "LOCAL") return " · LOCAL";
  if (country && city) return ` · ${city}, ${country}`;
  if (country) return ` · ${country}`;
  if (city) return ` · ${city}`;
  return "";
}

export function renderVisitorBadge(data: { count: number; recentVisits: VisitRecord[] }): string {
  const { count, recentVisits } = data;
  const recentCount = Math.min(recentVisits.length, 10);
  const height = 120 + recentCount * 24;

  let visitLines = "";
  for (let i = 0; i < recentCount; i++) {
    const visit = recentVisits[i];
    const y = 100 + i * 24;
    const location = formatLocation(visit.country, visit.city);
    visitLines += `  <text x="20" y="${y}" font-family="Arial, sans-serif" font-size="11" fill="#666">
    · #${visit.count} · ${formatTime(visit.time)}${location}
  </text>\n`;
  }

  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="380" height="${height}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.1" />
    </linearGradient>
  </defs>

  <!-- 背景 -->
  <rect width="380" height="${height}" rx="10" fill="url(#bg)" stroke="#667eea" stroke-width="2"/>

  <!-- Logo -->
  <svg x="20" y="15" width="40" height="40" viewBox="0.428571 0 127.571 128">
    <path fill="#f20606" d="M73.5 3c-.3333 2-1.3333 3.16667-3 3.5-.8333.16667-1.6667.33333-2.5.5.8333 1.33333 1.6667 2.66667 2.5 4 .8333 1.3333 1.6667 2.6667 2.5 4-6.8333-.6667-13.6667-1.3333-20.5-2q-20.50005-1.99995-21 0c-.3333 1.3333.5 3.3333 2.5 6 1 1.3333 2 2.6667 3 4-2.6667.3333-5.3333.6667-8 1-5.3333.6667-8.5 1.5-9.5 2.5L18 28c1 .6667 2 1.3333 3 2s2 1.3333 3 2c-2.8333 1.3333-5.6667 2.6667-8.5 4-5.66667 2.6667-9 3.8333-10 3.5-.5-.1667-1-.3333-1.5-.5 2.16667 2.3333 4.33333 4.6667 6.5 7q6.49995 7.00005 12 9c1.8333.6667 3.6667 1.3333 5.5 2-1.6667 1-3.3333 2-5 3-3.3333 2-5 3.3333-5 4s1.8333 1.6667 5.5 3 5.3333 2.6667 5 4c-.1667.6667-.3333 1.3333-.5 2-.3333-.6667-.6667-1.3333-1-2s-.6667-1.3333-1-2l-1 1c-.6667.6667-1.8333.6667-3.5 0-.8333-.3333-1.6667-.6667-2.5-1 .1667.5.3333 1 .5 1.5s.3333 1 .5 1.5c-.8333-.3333-1.6667-.6667-2.5-1-1.6667-.6667-4.8333-6.5-9.5-17.5C5.66667 48 3.33333 42.5 1 37c-.166667.8333-.333333 1.6667-.5 2.5-.333333 1.6667.5 5 2.5 10s8.3333 19.3333 19 43c10.6667 23.667 17.1667 35.333 19.5 35 1.1667-.167 2.3333-.333 3.5-.5-.8333-1.333-1.6667-2.667-2.5-4-1.6667-2.667-3-7-4-13s-.3333-10.1667 2-12.5 4.5-3.6667 6.5-4 3.5-.5 4.5-.5 2 1.8333 3 5.5c1 3.667 2 6 3 7q1.5 1.5-1.5 6c-2 3-3.3333 6.5-4 10.5-.3333 2-.6667 4-1 6h3v-4c0-2.667.8333-5.5 2.5-8.5s3.8333-5.833 6.5-8.5 5.6667-4.833 9-6.5c3.3333-1.6667 7.1667-2.5 11.5-2.5s7.6667.6667 10 2c1.1667.667 2.3333 1.333 3.5 2-.5.667-1 1.333-1.5 2-1 1.333-1.1667 2.833-.5 4.5.3333.833.6667 1.667 1 2.5-1.1667-.833-2.3333-1.667-3.5-2.5-2.3333-1.667-4.3333-2.5-6-2.5q-2.50005 0-4.5 1.5c-.6667.5-1.3333 1-2 1.5l4.5 1.5c3 1 5.5 2.333 7.5 4s2.6667 3.833 2 6.5c-.3333 1.333-.6667 2.667-1 4-1.5-1.167-3-2.333-4.5-3.5-3-2.333-6.1667-3.667-9.5-4-1.6667-.167-3.3333-.333-5-.5 1.6667 1.833 3.3333 3.667 5 5.5 3.3333 3.667 5.5 5.333 6.5 5 .5-.167 1-.333 1.5-.5-1-1.167-2-2.333-3-3.5s-2-2.333-3-3.5c1.1667.333 2.3333.667 3.5 1 2.3333.667 4.1667 2 5.5 4s3 3 5 3 3.6667-.833 5-2.5c1.333-1.667-.1667-4.833-4.5-9.5-2.1667-2.333-4.3333-4.667-6.5-7 1.1667.833 2.3333 1.667 3.5 2.5q3.49995 2.5005 7.5 0c1.333-.833 2.667-1.667 4-2.5 1.5 3.167 3 6.333 4.5 9.5 3 6.333 6.833 9.167 11.5 8.5s7.167-1.333 7.5-2c.167-.333.333-.667.5-1h-9c.167.333.333.667.5 1s.333.667.5 1c-.833.167-1.667.333-2.5.5-1.667.333-2.833 0-3.5-1s-1-1.833-1-2.5v-1h6c4 0 6.5-.333 7.5-1s1.5-1.833 1.5-3.5V115c-.167.333-.333.667-.5 1-.333.667-2 .667-5 0-1.5-.333-3-.667-4.5-1 1.167-3 2.333-6 3.5-9 2.333-6 3.5-10.1667 3.5-12.5V90c-.667.6667-1.333 1.3333-2 2-1.333 1.3333-1.667 2.5-1 3.5s0 4.3333-2 10c-2 5.667-4 8.5-6 8.5h-3v-2c0-1.333.833-3.667 2.5-7s3.5-10.8333 5.5-22.5 4-20.8333 6-27.5c1-3.3333 2-6.6667 3-10-.5.8333-1 1.6667-1.5 2.5-1 1.6667-3.333 2.3333-7 2s-6-3.8333-7-10.5-3.333-12.5-7-17.5-6-7.5-7-7.5H97v6c-.8333-.5-1.6667-1-2.5-1.5-1.6667-1-2.6667-3.8333-3-8.5-.1667-2.33333-.3333-4.66667-.5-7 5.8333 1 11.667 2 17.5 3 11.667 2 17.833 3 18.5 3h1V7.5c0-1-6.167-2.16667-18.5-3.5-6.167-.66667-12.3333-1.33333-18.5-2v13h-2V0c-.3333.333333-.6667.666667-1 1-.6667.66667-.8333 2.83333-.5 6.5.1667 1.83333.3333 3.6667.5 5.5-.8333-.3333-1.6667-.6667-2.5-1-1.6667-.6667-2.8333-2.83333-3.5-6.5-.3333-1.83333-.6667-3.66667-1-5.5-.1667.333333-.3333.666667-.5 1-.1667.33333-.3333.66667-.5 1-.3333-.33333-.6667-.66667-1-1-.3333-.333333-.6667-.666667-1-1 .1667 1.5.3333 3 .5 4.5s.3333 3 .5 4.5c-.5-.16667-1-.33333-1.5-.5-1-.33333-1.5-1.66667-1.5-4s-.3333-3.666667-1-4c-.3333-.166667-.6667-.333333-1-.5-.1667 1-.3333 2-.5 3m39-.5c5.167.83333 10.333 1.66667 15.5 2.5V4c0-.66667-1-1.33333-3-2S117.833.833333 109.5.5C105.333.333333 101.167.166667 97 0c5.167.833333 10.333 1.66667 15.5 2.5M74 2c.1667.83333.3333 1.66667.5 2.5s.3333 1.66667.5 2.5c-.1667-.83333-.3333-1.66667-.5-2.5S74.1667 2.83333 74 2m6 2v3.5c0 2.33333 2 4.5 6 6.5q6 3 9 6l3 3c.1667-1.3333.3333-2.6667.5-4s.3333-2.6667.5-4l4.5 6c3 4 5.167 9.1667 6.5 15.5s1.667 12.1667 1 17.5-1.833 9.6667-3.5 13-3.833 6-6.5 8c-1.3333 1-2.6667 2-4 3 .6667-1.5 1.3333-3 2-4.5s1.333-3 2-4.5c-.667.5-1.3333 1-2 1.5-1.3333 1-3.1667 1.3333-5.5 1s-4 0-5 1L87 74c1.1667.3333 2.3333.6667 3.5 1s2.3333.6667 3.5 1c-.3333.6667-.6667 1.3333-1 2-.6667 1.3333-3.5 2.6667-8.5 4s-10.6667 1.5-17 .5-9.5-2-9.5-3V78c-.6667.1667-1.3333.3333-2 .5s-1.3333.3333-2 .5v-1c0-.6667-1.1667-1.6667-3.5-3s-3.8333-3.1667-4.5-5.5-.1667-5 1.5-8c.8333-1.5 1.6667-3 2.5-4.5.3333.6667.6667 1.3333 1 2s.6667 1.3333 1 2v-2.5c0-1.6667.5-3 1.5-4L55 53l-1-1c-.6667-.6667-.5-1.8333.5-3.5s2.1667-2.6667 3.5-3 2.5-.1667 3.5.5q1.5 1.00005 3 0c.5-.3333 1-.6667 1.5-1-1 .6667-2 1.3333-3 2s-2 1.3333-3 2c1-.1667 2-.3333 3-.5 2-.3333 3.1667.1667 3.5 1.5s1 2 2 2H70c-.3333-1-.6667-2-1-3-.6667-2 .1667-3.8333 2.5-5.5 1.1667-.8333 2.3333-1.6667 3.5-2.5-.8333 2.1667-1.6667 4.3333-2.5 6.5S70.8333 51.8333 70 54c1.3333-.3333 2.6667-.6667 4-1s2.6667-.6667 4-1v3h1c.6667 0 3.1667-.8333 7.5-2.5s7-2 8-1 1.5 2.6667 1.5 5V60c.5-.1667 1-.3333 1.5-.5 1-.3333 1.6667-.1667 2 .5.1667.3333.3333.6667.5 1v-7h-2c.1667-.5.3333-1 .5-1.5.3333-1 0-2-1-3L96 48h4c-.3333-.5-.6667-1-1-1.5-.6667-1-.3333-2.3333 1-4 1.333-1.6667 2-3.1667 2-4.5v-2c-1 1.6667-2 3.3333-3 5-2 3.3333-3.8333 4.8333-5.5 4.5-.8333-.1667-1.6667-.3333-2.5-.5 1-1.1667 2-2.3333 3-3.5s2-2.3333 3-3.5l-3.5 3.5C91.1667 43.8333 89.3333 45 88 45h-2c.5-1.3333 1-2.6667 1.5-4 1-2.6667 1.3333-4.8333 1-6.5-.1667-.8333-.3333-1.6667-.5-2.5l-1.5 6c-1 4-2.1667 6-3.5 6h-2c.3333.5.6667 1 1 1.5s.6667 1 1 1.5c-1.6667.8333-3.3333 1.6667-5 2.5s-3.3333 1.6667-5 2.5c.8333-1.1667 1.6667-2.3333 2.5-3.5q2.50005-3.49995 1.5-4.5c-.6667-.6667-.3333-2.6667 1-6 .6667-1.6667 1.3333-3.3333 2-5-1.6667 1.8333-3.3333 3.6667-5 5.5-3.3333 3.6667-5.6667 5.1667-7 4.5-.6667-.3333-1.3333-.6667-2-1 1.1667-1.5 2.3333-3 3.5-4.5 2.3333-3 3.5-5.1667 3.5-6.5v-2c-1.3333 2.3333-2.6667 4.6667-4 7-2.6667 4.6667-5 6.8333-7 6.5-1-.1667-2-.3333-3-.5.6667-1.6667 1.3333-3.3333 2-5s1.3333-3.3333 2-5l-3 4.5c-2 3-4.1667 4.6667-6.5 5-1.1667.1667-2.3333.3333-3.5.5.8333-1.5 1.6667-3 2.5-4.5s1.6667-3 2.5-4.5c-1.1667 1-2.3333 2-3.5 3-2.3333 2-4.1667 4.8333-5.5 8.5S44.1667 54 44.5 62c.1667 4 .3333 8 .5 12-1.1667-.8333-2.3333-1.6667-3.5-2.5S39.1667 69.8333 38 69v2.5c0 1.6667-1.1667 2.6667-3.5 3-1.1667.1667-2.3333.3333-3.5.5.8333-1 1.6667-2 2.5-3s1.6667-2 2.5-3c-2.3333-1-4.6667-2-7-3s-4.6667-2-7-3c1.6667-1.1667 3.3333-2.3333 5-3.5s3.3333-2.3333 5-3.5c-2.1667-.6667-4.3333-1.3333-6.5-2-4.3333-1.3333-8.1667-3.5-11.5-6.5s-5-5-5-6 3.3333-2.8333 10-5.5c3.3333-1.3333 6.6667-2.6667 10-4-1.3333-.8333-2.6667-1.6667-4-2.5s-2.6667-1.6667-4-2.5c2.3333-.5 4.6667-1 7-1.5 4.6667-1 8.1667-1.3333 10.5-1 1.1667.1667 2.3333.3333 3.5.5-1.5-1.6667-3-3.3333-4.5-5-3-3.3333-4.5-5.5-4.5-6.5V12c7.1667.8333 14.3333 1.6667 21.5 2.5S68.8333 16.1667 76 17c-1-1.6667-2-3.3333-3-5s-2-3.33333-3-5c1.6667.5 3.3333 1 5 1.5s3.3333 1 5 1.5zm.5 33.5c-.8333 1.8333-1.6667 3.6667-2.5 5.5l2-2c1.3333-1.3333 2.1667-3.1667 2.5-5.5.1667-1.1667.3333-2.3333.5-3.5-.8333 1.8333-1.6667 3.6667-2.5 5.5M115 35c.667.6667 1.333 1.3333 2 2-.667-.6667-1.333-1.3333-2-2s-1.333-1.3333-2-2c.667.6667 1.333 1.3333 2 2m-62.5 8H55v1c0 .6667-1.5 3.5-4.5 8.5L46 60v-5c0-3.3333.6667-6.1667 2-8.5s2.8333-3.5 4.5-3.5m38 4H93c-.1667.3333-.3333.6667-.5 1-.3333.6667-2.3333 1.5-6 2.5-1.8333.5-3.6667 1-5.5 1.5 1.1667-.8333 2.3333-1.6667 3.5-2.5 2.3333-1.6667 4.3333-2.5 6-2.5m-35 4c-.1667.3333-.3333.6667-.5 1 1.3333.1667 2.6667.3333 4 .5 2.6667.3333 4.1667 1.6667 4.5 4s0 4-1 5-3 1.1667-6 .5c-1.5-.3333-3-.6667-4.5-1v3h5c3.3333 0 5.5-.6667 6.5-2s1.5-3 1.5-5-.6667-3.6667-2-5-2.8333-2-4.5-2-2.6667.3333-3 1m57.5 0h4.5c3 0 4.833.3333 5.5 1 .333.3333.667.6667 1 1h-11zm-30 5.5c-1.3333 1.6667-2 3.3333-2 5s.3333 2.6667 1 3c.3333.1667.6667.3333 1 .5v-4c0-2.6667 1-4.3333 3-5s3.6667 0 5 2 1.8333 3.6667 1.5 5q-.49995 1.99995-1.5 3c-.6667.6667-2.6667.8333-6 .5-1.6667-.1667-3.3333-.3333-5-.5 1.8333.3333 3.6667.6667 5.5 1 3.6667.6667 6 0 7-2s1.3333-3.8333 1-5.5-1-3-2-4-2.3333-1.5-4-1.5-3.1667.8333-4.5 2.5m30-1.5 5 .5 5 .5c-.167.3333-.333.6667-.5 1-.333.6667-1.667 1-4 1q-3.4995 0-4.5-1.5c-.333-.5-.667-1-1-1.5m2 4h7c-.333 1.3333-.667 2.6667-1 4-.667 2.6667-2.667 4-6 4h-5c.333-1.1667.667-2.3333 1-3.5q1.0005-3.49995 4.5-3c1.167.1667 2.333.3333 3.5.5-.667-.3333-1.333-.6667-2-1s-1.333-.6667-2-1m-20 7c-1 1.6667-2 3.3333-3 5 1.1667-1.3333 2.3333-2.6667 3.5-4 2.3333-2.6667 3.3333-4.3333 3-5-.1667-.3333-.3333-.6667-.5-1-1 1.6667-2 3.3333-3 5m-22-2.5c.3333.5.6667 1 1 1.5.1667-.3333.3333-.6667.5-1s.3333-.6667.5-1c-.5-.1667-1-.3333-1.5-.5s-1-.3333-1.5-.5c.3333.5.6667 1 1 1.5m-21 2c.3333.1667.6667.3333 1 .5l-1 1-1 1c1.5-.1667 3-.3333 4.5-.5s3-.3333 4.5-.5c-1.5-.3333-3-.6667-4.5-1s-3-.6667-4.5-1c.3333.1667.6667.3333 1 .5m5 3c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m26 0c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m31 0c3.333.3333 5 1.1667 5 2.5s-1.167 7.6667-3.5 19c-2.333 11.333-3.833 18-4.5 20s-1.333 3-2 3-1.833-2-3.5-6c-.833-2-1.667-4-2.5-6h9c-1.667-.167-3.333-.333-5-.5-3.333-.333-5.667-2.5-7-6.5-.6667-2-1.3333-4-2-6h4c-.167-.8333-.333-1.6667-.5-2.5-.333-1.6667-.167-2.8333.5-3.5s.667-1.5 0-2.5.333-3.1667 3-6.5q4.0005-4.99995 9-4.5m-60 1c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m33 .5 1 1zl-1-1zm-56 0h2c-.1667.3333-.3333.6667-.5 1s-.3333.6667-.5 1c-.1667-.3333-.3333-.6667-.5-1s-.3333-.6667-.5-1m-10 1c.8333.6667 1.6667 1.3333 2.5 2 1.6667 1.3333 3.1667 1.5 4.5.5.6667-.5 1.3333-1 2-1.5-.3333 1-.6667 2-1 3-.6667 2-1.6667 3.1667-3 3.5-.6667.1667-1.3333.3333-2 .5l1.5 1.5L27 82c-.6667.5-1.3333 1-2 1.5s-1.3333 1-2 1.5c-1-1.8333-2-3.6667-3-5.5s-2-3.6667-3-5.5c.8333.1667 1.6667.3333 2.5.5s1.6667.3333 2.5.5c-.1667-.6667-.3333-1.3333-.5-2s-.3333-1.3333-.5-2m18 1 3 3c2 2 3.3333 3 4 3h1v-3c.6667.5 1.3333 1 2 1.5 1.3333 1 3.1667 3.1667 5.5 6.5 1.1667 1.6667 2.3333 3.3333 3.5 5 .1667-.3333.3333-.6667.5-1s.3333-.6667.5-1c.3333.1667.6667.3333 1 .5.6667.3333 1.5 2 2.5 5s.8333 5.1667-.5 6.5l-2 2c.5-.1667 1-.3333 1.5-.5s1-.3333 1.5-.5c.1667.6667.3333 1.333.5 2 .3333 1.333 0 2.5-1 3.5L61 106c-.5-.667-1-1.333-1.5-2-1-1.333-.8333-3.333.5-6 .6667-1.3333 1.3333-2.6667 2-4-.8333.3333-1.6667.6667-2.5 1s-1.6667.6667-2.5 1v-1.5c0-1-.6667-1.8333-2-2.5s-2.1667-2-2.5-4-1.1667-3.5-2.5-4.5-2.5-1.5-3.5-1.5H45c.1667.5.3333 1 .5 1.5.3333 1-.3333 2-2 3q-2.50005 1.5-4.5 6c-.6667 1.5-1.3333 3-2 4.5-.3333-1.8333-.6667-3.6667-1-5.5s-.6667-3.6667-1-5.5c-.5 2.3333-1 4.6667-1.5 7-1 4.6667-1.6667 7.333-2 8-.1667.333-.3333.667-.5 1-.3333-.167-.6667-.333-1-.5-.6667-.333-1.6667-2-3-5s-2-5.1667-2-6.5.5-2.5 1.5-3.5L28 85l-1-1-1-1c.6667-.3333 1.3333-.6667 2-1s1.3333-.6667 2-1c-.5-.3333-1-.6667-1.5-1s-1-.6667-1.5-1l6-1.5c4-1 6-2.1667 6-3.5zm28 3c-.3333.6667-.6667 1.3333-1 2h10c-.3333-.6667-.6667-1.3333-1-2-.6667-1.3333-2-2-4-2s-3.3333.6667-4 2m5 0c.6667.3333 1.3333.6667 2 1h-6l1-1q1.00005-1.00005 3 0m53-.5c.333.1667.667.3333 1 .5-.333-.1667-.667-.3333-1-.5s-.667-.3333-1-.5c.333.1667.667.3333 1 .5m-40 5c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m15 0c.333.1667.667.3333 1 .5l-1.5 1.5c-1 1-1.1667 2.1667-.5 3.5.3333.6667.6667 1.3333 1 2-.8333-.5-1.6667-1-2.5-1.5s-1.6667-1-2.5-1.5c.1667.6667.3333 1.3333.5 2s.3333 1.3333.5 2c-2.1667.5-4.3333 1-6.5 1.5-4.3333 1-6.5 2-6.5 3V94h-5c.1667.3333.3333.6667.5 1s.3333.6667.5 1c-.3333.1667-.6667.3333-1 .5-.6667.3333-2.8333.5-6.5.5s-5.6667-.3333-6-1c-.1667-.3333-.3333-.6667-.5-1h3c-.6667-.3333-1.3333-.6667-2-1-1.3333-.6667-2-1.6667-2-3s-.6667-2.6667-2-4l-2-2c1.6667.1667 3.3333.3333 5 .5s3.3333.3333 5 .5c-.1667.3333-.3333.6667-.5 1s-.3333.6667-.5 1c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5l-2 2-2 2c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5c.3333-.6667.6667-1.3333 1-2s.6667-1.3333 1-2l1 1 1 1c1-1.1667 2-2.3333 3-3.5 2-2.3333 4.6667-3.6667 8-4s6.6667-1.3333 10-3 5.3333-2.3333 6-2m26 4c-.333 1.5-.667 3-1 4.5.5-.6667 1-1.3333 1.5-2 1-1.3333 1.333-2.8333 1-4.5-.167-.8333-.333-1.6667-.5-2.5-.333 1.5-.667 3-1 4.5m-88.5-1c-1 1-1.3333 2.1667-1 3.5.1667.6667.3333 1.3333.5 2 1.3333-.6667 2.6667-1.3333 4-2s2.6667-1.3333 4-2c-1 .3333-2 .6667-3 1s-2 .6667-3 1c.3333-.6667.6667-1.3333 1-2s.6667-1.3333 1-2c-.3333-.1667-.6667-.3333-1-.5-.6667-.3333-1.5 0-2.5 1M57 82l1 1 1 1-1-1zm-8 4c1.3333.6667 2.1667 1.6667 2.5 3 .1667.6667.3333 1.3333.5 2h-4.5c-3 0-5.1667.6667-6.5 2l-2 2c1.3333-1.6667 2.6667-3.3333 4-5 2.6667-3.3333 4.6667-4.6667 6-4m-26 0c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5c-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5m51 0h1c-.1667.5-.3333 1-.5 1.5s-.3333 1-.5 1.5c-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.1667-.3333.3333-.6667.5-1 .3333-.6667.8333-1 1.5-1m19.5 1c.1667.3333.3333.6667.5 1-.1667-.3333-.3333-.6667-.5-1s-.3333-.6667-.5-1c.1667.3333.3333.6667.5 1M45 89.5c-.3333.5-.6667 1-1 1.5.3333-.5.6667-1 1-1.5s.6667-1 1-1.5c-.3333.5-.6667 1-1 1.5m52 2c.3333.8333.6667 1.6667 1 2.5-1-.1667-2-.3333-3-.5-2-.3333-3.8333 0-5.5 1S86 96 84 96h-3c.8333-.3333 1.6667-.6667 2.5-1 1.6667-.6667 2.5-1.3333 2.5-2s1.6667-1.5 5-2.5 5.3333-.6667 6 1M96 96c2.6667.6667 4.333 2.3333 5 5 .333 1.333.667 2.667 1 4l-3-3c-2-2-4-3.3333-6-4-1-.3333-2-.6667-3-1l1-1c.6667-.6667 2.3333-.6667 5 0m-40 1 1 1 1 1-1-1zm11 1c.5.1667 1 .3333 1.5.5s1 .3333 1.5.5c-.5.1667-1 .3333-1.5.5s-1 .3333-1.5.5zm-2 1c.1667.3333.3333.6667.5 1 .1667.333.3333.667.5 1-.1667-.333-.3333-.667-.5-1-.1667-.3333-.3333-.6667-.5-1m-33 3c.1667.667.3333 1.333.5 2s.3333 1.333.5 2c.5-.333 1-.667 1.5-1s1-.667 1.5-1c.6667 3.333 1.3333 6.667 2 10s1.3333 6.667 2 10c-1.3333-2.667-2.6667-5.333-4-8-2.6667-5.333-4-9-4-11zm65 2c.5.667 1 1.333 1.5 2 1 1.333.8333 2.667-.5 4-.6667.667-1.3333 1.333-2 2-.1667-1-.3333-2-.5-3-.3333-2-.1667-3.333.5-4 .3333-.333.6667-.667 1-1m29 4c.333.667.667 1.333 1 2-.333-.667-.667-1.333-1-2s-.667-1.333-1-2c.333.667.667 1.333 1 2m-43 0c1 .167 2 .333 3 .5s2 .333 3 .5c-.6667.167-1.3333.333-2 .5-1.3333.333-2.3333.167-3-.5-.3333-.333-.6667-.667-1-1m26 6c.167.333.333.667.5 1s.333.667.5 1c-.167-.333-.333-.667-.5-1s-.333-.667-.5-1m2 1c.667.167 1.333.333 2 .5s1.333.333 2 .5c-.667-.167-1.333-.333-2-.5s-1.333-.333-2-.5m-1 2h6.5c4.333 0 7 .333 8 1 .5.333 1 .667 1.5 1-2.333.333-4.667.667-7 1-4.667.667-7.333.333-8-1-.333-.667-.667-1.333-1-2m-31 2c.3333.167.6667.333 1 .5s.6667.333 1 .5c-.3333-.167-.6667-.333-1-.5s-.6667-.333-1-.5m15 0c.8333.333 1.6667.667 2.5 1s1.6667.667 2.5 1c-.5.833-1 1.667-1.5 2.5s-1 1.667-1.5 2.5c-.3333-1.167-.6667-2.333-1-3.5s-.6667-2.333-1-3.5m-26 7c.6667 1.333 1.5 2 2.5 2H72c-.8333-.667-1.6667-1.333-2.5-2s-1.6667-1.333-2.5-2c.3333.667.6667 1.333 1 2"/>
  </svg>

  <!-- 主标题 -->
  <text x="70" y="32" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#667eea">
    路过打卡 · Traces
  </text>

  <!-- 访问次数 -->
  <text x="70" y="50" font-family="Arial, sans-serif" font-size="14" fill="#667eea">
    ${count} 次访问 · ${count} visits
  </text>

  <!-- 副标题 -->
  <text x="70" y="68" font-family="Arial, sans-serif" font-size="11" fill="#999">
    最近记录 · Recent records
  </text>

  <!-- 分隔线 -->
  <line x1="20" y1="80" x2="360" y2="80" stroke="#667eea" stroke-width="1" stroke-dasharray="5,5"/>

${visitLines}
</svg>`;
}

interface LikeRecord {
  count: number;
  time: string;
  country?: string;
  city?: string;
  ip?: string;
}

export function renderCombinedBadge(visitData: { count: number; recentVisits: VisitRecord[] }, likeData: { count: number; recentLikes: LikeRecord[] }, namespace: string, key: string): string {
  const maxRecords = Math.max(visitData.recentVisits.length, likeData.recentLikes.length, 5);
  const badgeHeight = 120 + maxRecords * 24;
  const buttonHeight = 70;
  const gap = 10;
  const totalHeight = badgeHeight + gap + buttonHeight;
  const likeUrl = `${BASE_URL}/v1/like/${namespace}/${key}/add`;

  // 根据用户名决定头像来源
  const avatarUrl = namespace === 'ailuntz'
    ? AILUNTZ_AVATAR_URL  // 使用本地 avatar.svg 的 base64 编码
    : `https://github.com/${namespace}.png`;

  let visitLines = "";
  for (let i = 0; i < Math.min(visitData.recentVisits.length, 10); i++) {
    const visit = visitData.recentVisits[i];
    const y = 100 + i * 24;
    const location = formatLocation(visit.country, visit.city);
    visitLines += `  <text x="20" y="${y}" font-family="Arial, sans-serif" font-size="11" fill="#666">
    · #${visit.count} · ${formatTime(visit.time)}${location}
  </text>\n`;
  }

  let likeLines = "";
  for (let i = 0; i < Math.min(likeData.recentLikes.length, 10); i++) {
    const like = likeData.recentLikes[i];
    const y = 100 + i * 24;
    const location = formatLocation(like.country, like.city);
    likeLines += `  <text x="410" y="${y}" font-family="Arial, sans-serif" font-size="11" fill="#666">
    · #${like.count} · ${formatTime(like.time)}${location}
  </text>\n`;
  }

  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="780" height="${totalHeight}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bgVisit" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="bgLike" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="likeBtnBg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.15" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:0.15" />
    </linearGradient>
    <!-- 圆形裁剪路径 - 左侧 -->
    <clipPath id="avatarClipLeft">
      <circle cx="40" cy="35" r="20"/>
    </clipPath>
    <!-- 圆形裁剪路径 - 右侧 -->
    <clipPath id="avatarClipRight">
      <circle cx="430" cy="35" r="20"/>
    </clipPath>
  </defs>

  <!-- 左侧：访问统计 -->
  <g>
    <!-- 背景 -->
    <rect x="0" y="0" width="380" height="${badgeHeight}" rx="10" fill="url(#bgVisit)" stroke="#667eea" stroke-width="2"/>

    <!-- 头像 -->
    <g clip-path="url(#avatarClipLeft)">
      <image href="${avatarUrl}" x="20" y="15" width="40" height="40"/>
    </g>

    <!-- 主标题 -->
    <text x="70" y="32" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#667eea">
      路过打卡 · Traces
    </text>

    <!-- 访问次数 -->
    <text x="70" y="50" font-family="Arial, sans-serif" font-size="14" fill="#667eea">
      ${visitData.count} 次访问 · ${visitData.count} visits
    </text>

    <!-- 副标题 -->
    <text x="70" y="68" font-family="Arial, sans-serif" font-size="11" fill="#999">
      最近记录 · Recent records
    </text>

    <!-- 分隔线 -->
    <line x1="20" y1="80" x2="360" y2="80" stroke="#667eea" stroke-width="1" stroke-dasharray="5,5"/>

${visitLines}
  </g>

  <!-- 右侧：点赞统计 -->
  <g>
    <!-- 背景 -->
    <rect x="390" y="0" width="380" height="${badgeHeight}" rx="10" fill="url(#bgLike)" stroke="#f5576c" stroke-width="2"/>

    <!-- 头像 -->
    <g clip-path="url(#avatarClipRight)">
      <image href="${avatarUrl}" x="410" y="15" width="40" height="40"/>
    </g>

    <!-- 主标题 -->
    <text x="460" y="32" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f5576c">
      心动点赞 · Heartfelt
    </text>

    <!-- 点赞次数 -->
    <text x="460" y="50" font-family="Arial, sans-serif" font-size="14" fill="#f5576c">
      ${likeData.count} 次点赞 · ${likeData.count} likes
    </text>

    <!-- 副标题 -->
    <text x="460" y="68" font-family="Arial, sans-serif" font-size="11" fill="#999">
      最近记录 · Recent records
    </text>

    <!-- 分隔线 -->
    <line x1="410" y1="80" x2="750" y2="80" stroke="#f5576c" stroke-width="1" stroke-dasharray="5,5"/>

${likeLines}
  </g>

  <!-- 点赞按钮 -->
  <a href="${likeUrl}">
    <rect x="0" y="${badgeHeight + gap}" width="780" height="${buttonHeight}" rx="10" fill="url(#likeBtnBg)" stroke="#f5576c" stroke-width="2" style="cursor:pointer"/>

    <text x="30" y="${badgeHeight + gap + 28}" font-size="24" fill="#f5576c">❤️</text>

    <text x="70" y="${badgeHeight + gap + 28}" font-family="Arial, sans-serif" font-size="15" font-weight="bold" fill="#f5576c">
      给我点赞 · Give a Like
    </text>

    <text x="70" y="${badgeHeight + gap + 50}" font-family="Arial, sans-serif" font-size="11" fill="#999">
      已有 ${likeData.count} 人点赞 · ${likeData.count} likes
    </text>

    <text x="630" y="${badgeHeight + gap + 42}" font-family="Arial, sans-serif" font-size="13" fill="#f5576c" style="cursor:pointer">
      点击 · Click →
    </text>
  </a>

</svg>`;
}

export function renderLikeBadge(data: { count: number; recentLikes: LikeRecord[] }): string {
  const { count, recentLikes } = data;
  const recentCount = Math.min(recentLikes.length, 10);
  const height = 120 + recentCount * 24;

  let likeLines = "";
  for (let i = 0; i < recentCount; i++) {
    const like = recentLikes[i];
    const y = 100 + i * 24;
    const location = formatLocation(like.country, like.city);
    likeLines += `  <text x="20" y="${y}" font-family="Arial, sans-serif" font-size="11" fill="#666">
    · #${like.count} · ${formatTime(like.time)}${location}
  </text>\n`;
  }

  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="380" height="${height}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="likeBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:0.1" />
    </linearGradient>
  </defs>

  <!-- 背景 -->
  <rect width="380" height="${height}" rx="10" fill="url(#likeBg)" stroke="#f5576c" stroke-width="2"/>

  <!-- Logo -->
  <svg x="20" y="15" width="40" height="40" viewBox="0.428571 0 127.571 128">
    <path fill="#f20606" d="M73.5 3c-.3333 2-1.3333 3.16667-3 3.5-.8333.16667-1.6667.33333-2.5.5.8333 1.33333 1.6667 2.66667 2.5 4 .8333 1.3333 1.6667 2.6667 2.5 4-6.8333-.6667-13.6667-1.3333-20.5-2q-20.50005-1.99995-21 0c-.3333 1.3333.5 3.3333 2.5 6 1 1.3333 2 2.6667 3 4-2.6667.3333-5.3333.6667-8 1-5.3333.6667-8.5 1.5-9.5 2.5L18 28c1 .6667 2 1.3333 3 2s2 1.3333 3 2c-2.8333 1.3333-5.6667 2.6667-8.5 4-5.66667 2.6667-9 3.8333-10 3.5-.5-.1667-1-.3333-1.5-.5 2.16667 2.3333 4.33333 4.6667 6.5 7q6.49995 7.00005 12 9c1.8333.6667 3.6667 1.3333 5.5 2-1.6667 1-3.3333 2-5 3-3.3333 2-5 3.3333-5 4s1.8333 1.6667 5.5 3 5.3333 2.6667 5 4c-.1667.6667-.3333 1.3333-.5 2-.3333-.6667-.6667-1.3333-1-2s-.6667-1.3333-1-2l-1 1c-.6667.6667-1.8333.6667-3.5 0-.8333-.3333-1.6667-.6667-2.5-1 .1667.5.3333 1 .5 1.5s.3333 1 .5 1.5c-.8333-.3333-1.6667-.6667-2.5-1-1.6667-.6667-4.8333-6.5-9.5-17.5C5.66667 48 3.33333 42.5 1 37c-.166667.8333-.333333 1.6667-.5 2.5-.333333 1.6667.5 5 2.5 10s8.3333 19.3333 19 43c10.6667 23.667 17.1667 35.333 19.5 35 1.1667-.167 2.3333-.333 3.5-.5-.8333-1.333-1.6667-2.667-2.5-4-1.6667-2.667-3-7-4-13s-.3333-10.1667 2-12.5 4.5-3.6667 6.5-4 3.5-.5 4.5-.5 2 1.8333 3 5.5c1 3.667 2 6 3 7q1.5 1.5-1.5 6c-2 3-3.3333 6.5-4 10.5-.3333 2-.6667 4-1 6h3v-4c0-2.667.8333-5.5 2.5-8.5s3.8333-5.833 6.5-8.5 5.6667-4.833 9-6.5c3.3333-1.6667 7.1667-2.5 11.5-2.5s7.6667.6667 10 2c1.1667.667 2.3333 1.333 3.5 2-.5.667-1 1.333-1.5 2-1 1.333-1.1667 2.833-.5 4.5.3333.833.6667 1.667 1 2.5-1.1667-.833-2.3333-1.667-3.5-2.5-2.3333-1.667-4.3333-2.5-6-2.5q-2.50005 0-4.5 1.5c-.6667.5-1.3333 1-2 1.5l4.5 1.5c3 1 5.5 2.333 7.5 4s2.6667 3.833 2 6.5c-.3333 1.333-.6667 2.667-1 4-1.5-1.167-3-2.333-4.5-3.5-3-2.333-6.1667-3.667-9.5-4-1.6667-.167-3.3333-.333-5-.5 1.6667 1.833 3.3333 3.667 5 5.5 3.3333 3.667 5.5 5.333 6.5 5 .5-.167 1-.333 1.5-.5-1-1.167-2-2.333-3-3.5s-2-2.333-3-3.5c1.1667.333 2.3333.667 3.5 1 2.3333.667 4.1667 2 5.5 4s3 3 5 3 3.6667-.833 5-2.5c1.333-1.667-.1667-4.833-4.5-9.5-2.1667-2.333-4.3333-4.667-6.5-7 1.1667.833 2.3333 1.667 3.5 2.5q3.49995 2.5005 7.5 0c1.333-.833 2.667-1.667 4-2.5 1.5 3.167 3 6.333 4.5 9.5 3 6.333 6.833 9.167 11.5 8.5s7.167-1.333 7.5-2c.167-.333.333-.667.5-1h-9c.167.333.333.667.5 1s.333.667.5 1c-.833.167-1.667.333-2.5.5-1.667.333-2.833 0-3.5-1s-1-1.833-1-2.5v-1h6c4 0 6.5-.333 7.5-1s1.5-1.833 1.5-3.5V115c-.167.333-.333.667-.5 1-.333.667-2 .667-5 0-1.5-.333-3-.667-4.5-1 1.167-3 2.333-6 3.5-9 2.333-6 3.5-10.1667 3.5-12.5V90c-.667.6667-1.333 1.3333-2 2-1.333 1.3333-1.667 2.5-1 3.5s0 4.3333-2 10c-2 5.667-4 8.5-6 8.5h-3v-2c0-1.333.833-3.667 2.5-7s3.5-10.8333 5.5-22.5 4-20.8333 6-27.5c1-3.3333 2-6.6667 3-10-.5.8333-1 1.6667-1.5 2.5-1 1.6667-3.333 2.3333-7 2s-6-3.8333-7-10.5-3.333-12.5-7-17.5-6-7.5-7-7.5H97v6c-.8333-.5-1.6667-1-2.5-1.5-1.6667-1-2.6667-3.8333-3-8.5-.1667-2.33333-.3333-4.66667-.5-7 5.8333 1 11.667 2 17.5 3 11.667 2 17.833 3 18.5 3h1V7.5c0-1-6.167-2.16667-18.5-3.5-6.167-.66667-12.3333-1.33333-18.5-2v13h-2V0c-.3333.333333-.6667.666667-1 1-.6667.66667-.8333 2.83333-.5 6.5.1667 1.83333.3333 3.6667.5 5.5-.8333-.3333-1.6667-.6667-2.5-1-1.6667-.6667-2.8333-2.83333-3.5-6.5-.3333-1.83333-.6667-3.66667-1-5.5-.1667.333333-.3333.666667-.5 1-.1667.33333-.3333.66667-.5 1-.3333-.33333-.6667-.66667-1-1-.3333-.333333-.6667-.666667-1-1 .1667 1.5.3333 3 .5 4.5s.3333 3 .5 4.5c-.5-.16667-1-.33333-1.5-.5-1-.33333-1.5-1.66667-1.5-4s-.3333-3.666667-1-4c-.3333-.166667-.6667-.333333-1-.5-.1667 1-.3333 2-.5 3m39-.5c5.167.83333 10.333 1.66667 15.5 2.5V4c0-.66667-1-1.33333-3-2S117.833.833333 109.5.5C105.333.333333 101.167.166667 97 0c5.167.833333 10.333 1.66667 15.5 2.5M74 2c.1667.83333.3333 1.66667.5 2.5s.3333 1.66667.5 2.5c-.1667-.83333-.3333-1.66667-.5-2.5S74.1667 2.83333 74 2m6 2v3.5c0 2.33333 2 4.5 6 6.5q6 3 9 6l3 3c.1667-1.3333.3333-2.6667.5-4s.3333-2.6667.5-4l4.5 6c3 4 5.167 9.1667 6.5 15.5s1.667 12.1667 1 17.5-1.833 9.6667-3.5 13-3.833 6-6.5 8c-1.3333 1-2.6667 2-4 3 .6667-1.5 1.3333-3 2-4.5s1.333-3 2-4.5c-.667.5-1.3333 1-2 1.5-1.3333 1-3.1667 1.3333-5.5 1s-4 0-5 1L87 74c1.1667.3333 2.3333.6667 3.5 1s2.3333.6667 3.5 1c-.3333.6667-.6667 1.3333-1 2-.6667 1.3333-3.5 2.6667-8.5 4s-10.6667 1.5-17 .5-9.5-2-9.5-3V78c-.6667.1667-1.3333.3333-2 .5s-1.3333.3333-2 .5v-1c0-.6667-1.1667-1.6667-3.5-3s-3.8333-3.1667-4.5-5.5-.1667-5 1.5-8c.8333-1.5 1.6667-3 2.5-4.5.3333.6667.6667 1.3333 1 2s.6667 1.3333 1 2v-2.5c0-1.6667.5-3 1.5-4L55 53l-1-1c-.6667-.6667-.5-1.8333.5-3.5s2.1667-2.6667 3.5-3 2.5-.1667 3.5.5q1.5 1.00005 3 0c.5-.3333 1-.6667 1.5-1-1 .6667-2 1.3333-3 2s-2 1.3333-3 2c1-.1667 2-.3333 3-.5 2-.3333 3.1667.1667 3.5 1.5s1 2 2 2H70c-.3333-1-.6667-2-1-3-.6667-2 .1667-3.8333 2.5-5.5 1.1667-.8333 2.3333-1.6667 3.5-2.5-.8333 2.1667-1.6667 4.3333-2.5 6.5S70.8333 51.8333 70 54c1.3333-.3333 2.6667-.6667 4-1s2.6667-.6667 4-1v3h1c.6667 0 3.1667-.8333 7.5-2.5s7-2 8-1 1.5 2.6667 1.5 5V60c.5-.1667 1-.3333 1.5-.5 1-.3333 1.6667-.1667 2 .5.1667.3333.3333.6667.5 1v-7h-2c.1667-.5.3333-1 .5-1.5.3333-1 0-2-1-3L96 48h4c-.3333-.5-.6667-1-1-1.5-.6667-1-.3333-2.3333 1-4 1.333-1.6667 2-3.1667 2-4.5v-2c-1 1.6667-2 3.3333-3 5-2 3.3333-3.8333 4.8333-5.5 4.5-.8333-.1667-1.6667-.3333-2.5-.5 1-1.1667 2-2.3333 3-3.5s2-2.3333 3-3.5l-3.5 3.5C91.1667 43.8333 89.3333 45 88 45h-2c.5-1.3333 1-2.6667 1.5-4 1-2.6667 1.3333-4.8333 1-6.5-.1667-.8333-.3333-1.6667-.5-2.5l-1.5 6c-1 4-2.1667 6-3.5 6h-2c.3333.5.6667 1 1 1.5s.6667 1 1 1.5c-1.6667.8333-3.3333 1.6667-5 2.5s-3.3333 1.6667-5 2.5c.8333-1.1667 1.6667-2.3333 2.5-3.5q2.50005-3.49995 1.5-4.5c-.6667-.6667-.3333-2.6667 1-6 .6667-1.6667 1.3333-3.3333 2-5-1.6667 1.8333-3.3333 3.6667-5 5.5-3.3333 3.6667-5.6667 5.1667-7 4.5-.6667-.3333-1.3333-.6667-2-1 1.1667-1.5 2.3333-3 3.5-4.5 2.3333-3 3.5-5.1667 3.5-6.5v-2c-1.3333 2.3333-2.6667 4.6667-4 7-2.6667 4.6667-5 6.8333-7 6.5-1-.1667-2-.3333-3-.5.6667-1.6667 1.3333-3.3333 2-5s1.3333-3.3333 2-5l-3 4.5c-2 3-4.1667 4.6667-6.5 5-1.1667.1667-2.3333.3333-3.5.5.8333-1.5 1.6667-3 2.5-4.5s1.6667-3 2.5-4.5c-1.1667 1-2.3333 2-3.5 3-2.3333 2-4.1667 4.8333-5.5 8.5S44.1667 54 44.5 62c.1667 4 .3333 8 .5 12-1.1667-.8333-2.3333-1.6667-3.5-2.5S39.1667 69.8333 38 69v2.5c0 1.6667-1.1667 2.6667-3.5 3-1.1667.1667-2.3333.3333-3.5.5.8333-1 1.6667-2 2.5-3s1.6667-2 2.5-3c-2.3333-1-4.6667-2-7-3s-4.6667-2-7-3c1.6667-1.1667 3.3333-2.3333 5-3.5s3.3333-2.3333 5-3.5c-2.1667-.6667-4.3333-1.3333-6.5-2-4.3333-1.3333-8.1667-3.5-11.5-6.5s-5-5-5-6 3.3333-2.8333 10-5.5c3.3333-1.3333 6.6667-2.6667 10-4-1.3333-.8333-2.6667-1.6667-4-2.5s-2.6667-1.6667-4-2.5c2.3333-.5 4.6667-1 7-1.5 4.6667-1 8.1667-1.3333 10.5-1 1.1667.1667 2.3333.3333 3.5.5-1.5-1.6667-3-3.3333-4.5-5-3-3.3333-4.5-5.5-4.5-6.5V12c7.1667.8333 14.3333 1.6667 21.5 2.5S68.8333 16.1667 76 17c-1-1.6667-2-3.3333-3-5s-2-3.33333-3-5c1.6667.5 3.3333 1 5 1.5s3.3333 1 5 1.5zm.5 33.5c-.8333 1.8333-1.6667 3.6667-2.5 5.5l2-2c1.3333-1.3333 2.1667-3.1667 2.5-5.5.1667-1.1667.3333-2.3333.5-3.5-.8333 1.8333-1.6667 3.6667-2.5 5.5M115 35c.667.6667 1.333 1.3333 2 2-.667-.6667-1.333-1.3333-2-2s-1.333-1.3333-2-2c.667.6667 1.333 1.3333 2 2m-62.5 8H55v1c0 .6667-1.5 3.5-4.5 8.5L46 60v-5c0-3.3333.6667-6.1667 2-8.5s2.8333-3.5 4.5-3.5m38 4H93c-.1667.3333-.3333.6667-.5 1-.3333.6667-2.3333 1.5-6 2.5-1.8333.5-3.6667 1-5.5 1.5 1.1667-.8333 2.3333-1.6667 3.5-2.5 2.3333-1.6667 4.3333-2.5 6-2.5m-35 4c-.1667.3333-.3333.6667-.5 1 1.3333.1667 2.6667.3333 4 .5 2.6667.3333 4.1667 1.6667 4.5 4s0 4-1 5-3 1.1667-6 .5c-1.5-.3333-3-.6667-4.5-1v3h5c3.3333 0 5.5-.6667 6.5-2s1.5-3 1.5-5-.6667-3.6667-2-5-2.8333-2-4.5-2-2.6667.3333-3 1m57.5 0h4.5c3 0 4.833.3333 5.5 1 .333.3333.667.6667 1 1h-11zm-30 5.5c-1.3333 1.6667-2 3.3333-2 5s.3333 2.6667 1 3c.3333.1667.6667.3333 1 .5v-4c0-2.6667 1-4.3333 3-5s3.6667 0 5 2 1.8333 3.6667 1.5 5q-.49995 1.99995-1.5 3c-.6667.6667-2.6667.8333-6 .5-1.6667-.1667-3.3333-.3333-5-.5 1.8333.3333 3.6667.6667 5.5 1 3.6667.6667 6 0 7-2s1.3333-3.8333 1-5.5-1-3-2-4-2.3333-1.5-4-1.5-3.1667.8333-4.5 2.5m30-1.5 5 .5 5 .5c-.167.3333-.333.6667-.5 1-.333.6667-1.667 1-4 1q-3.4995 0-4.5-1.5c-.333-.5-.667-1-1-1.5m2 4h7c-.333 1.3333-.667 2.6667-1 4-.667 2.6667-2.667 4-6 4h-5c.333-1.1667.667-2.3333 1-3.5q1.0005-3.49995 4.5-3c1.167.1667 2.333.3333 3.5.5-.667-.3333-1.333-.6667-2-1s-1.333-.6667-2-1m-20 7c-1 1.6667-2 3.3333-3 5 1.1667-1.3333 2.3333-2.6667 3.5-4 2.3333-2.6667 3.3333-4.3333 3-5-.1667-.3333-.3333-.6667-.5-1-1 1.6667-2 3.3333-3 5m-22-2.5c.3333.5.6667 1 1 1.5.1667-.3333.3333-.6667.5-1s.3333-.6667.5-1c-.5-.1667-1-.3333-1.5-.5s-1-.3333-1.5-.5c.3333.5.6667 1 1 1.5m-21 2c.3333.1667.6667.3333 1 .5l-1 1-1 1c1.5-.1667 3-.3333 4.5-.5s3-.3333 4.5-.5c-1.5-.3333-3-.6667-4.5-1s-3-.6667-4.5-1c.3333.1667.6667.3333 1 .5m5 3c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m26 0c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m31 0c3.333.3333 5 1.1667 5 2.5s-1.167 7.6667-3.5 19c-2.333 11.333-3.833 18-4.5 20s-1.333 3-2 3-1.833-2-3.5-6c-.833-2-1.667-4-2.5-6h9c-1.667-.167-3.333-.333-5-.5-3.333-.333-5.667-2.5-7-6.5-.6667-2-1.3333-4-2-6h4c-.167-.8333-.333-1.6667-.5-2.5-.333-1.6667-.167-2.8333.5-3.5s.667-1.5 0-2.5.333-3.1667 3-6.5q4.0005-4.99995 9-4.5m-60 1c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m33 .5 1 1zl-1-1zm-56 0h2c-.1667.3333-.3333.6667-.5 1s-.3333.6667-.5 1c-.1667-.3333-.3333-.6667-.5-1s-.3333-.6667-.5-1m-10 1c.8333.6667 1.6667 1.3333 2.5 2 1.6667 1.3333 3.1667 1.5 4.5.5.6667-.5 1.3333-1 2-1.5-.3333 1-.6667 2-1 3-.6667 2-1.6667 3.1667-3 3.5-.6667.1667-1.3333.3333-2 .5l1.5 1.5L27 82c-.6667.5-1.3333 1-2 1.5s-1.3333 1-2 1.5c-1-1.8333-2-3.6667-3-5.5s-2-3.6667-3-5.5c.8333.1667 1.6667.3333 2.5.5s1.6667.3333 2.5.5c-.1667-.6667-.3333-1.3333-.5-2s-.3333-1.3333-.5-2m18 1 3 3c2 2 3.3333 3 4 3h1v-3c.6667.5 1.3333 1 2 1.5 1.3333 1 3.1667 3.1667 5.5 6.5 1.1667 1.6667 2.3333 3.3333 3.5 5 .1667-.3333.3333-.6667.5-1s.3333-.6667.5-1c.3333.1667.6667.3333 1 .5.6667.3333 1.5 2 2.5 5s.8333 5.1667-.5 6.5l-2 2c.5-.1667 1-.3333 1.5-.5s1-.3333 1.5-.5c.1667.6667.3333 1.333.5 2 .3333 1.333 0 2.5-1 3.5L61 106c-.5-.667-1-1.333-1.5-2-1-1.333-.8333-3.333.5-6 .6667-1.3333 1.3333-2.6667 2-4-.8333.3333-1.6667.6667-2.5 1s-1.6667.6667-2.5 1v-1.5c0-1-.6667-1.8333-2-2.5s-2.1667-2-2.5-4-1.1667-3.5-2.5-4.5-2.5-1.5-3.5-1.5H45c.1667.5.3333 1 .5 1.5.3333 1-.3333 2-2 3q-2.50005 1.5-4.5 6c-.6667 1.5-1.3333 3-2 4.5-.3333-1.8333-.6667-3.6667-1-5.5s-.6667-3.6667-1-5.5c-.5 2.3333-1 4.6667-1.5 7-1 4.6667-1.6667 7.333-2 8-.1667.333-.3333.667-.5 1-.3333-.167-.6667-.333-1-.5-.6667-.333-1.6667-2-3-5s-2-5.1667-2-6.5.5-2.5 1.5-3.5L28 85l-1-1-1-1c.6667-.3333 1.3333-.6667 2-1s1.3333-.6667 2-1c-.5-.3333-1-.6667-1.5-1s-1-.6667-1.5-1l6-1.5c4-1 6-2.1667 6-3.5zm28 3c-.3333.6667-.6667 1.3333-1 2h10c-.3333-.6667-.6667-1.3333-1-2-.6667-1.3333-2-2-4-2s-3.3333.6667-4 2m5 0c.6667.3333 1.3333.6667 2 1h-6l1-1q1.00005-1.00005 3 0m53-.5c.333.1667.667.3333 1 .5-.333-.1667-.667-.3333-1-.5s-.667-.3333-1-.5c.333.1667.667.3333 1 .5m-40 5c.3333.1667.6667.3333 1 .5-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.3333.1667.6667.3333 1 .5m15 0c.333.1667.667.3333 1 .5l-1.5 1.5c-1 1-1.1667 2.1667-.5 3.5.3333.6667.6667 1.3333 1 2-.8333-.5-1.6667-1-2.5-1.5s-1.6667-1-2.5-1.5c.1667.6667.3333 1.3333.5 2s.3333 1.3333.5 2c-2.1667.5-4.3333 1-6.5 1.5-4.3333 1-6.5 2-6.5 3V94h-5c.1667.3333.3333.6667.5 1s.3333.6667.5 1c-.3333.1667-.6667.3333-1 .5-.6667.3333-2.8333.5-6.5.5s-5.6667-.3333-6-1c-.1667-.3333-.3333-.6667-.5-1h3c-.6667-.3333-1.3333-.6667-2-1-1.3333-.6667-2-1.6667-2-3s-.6667-2.6667-2-4l-2-2c1.6667.1667 3.3333.3333 5 .5s3.3333.3333 5 .5c-.1667.3333-.3333.6667-.5 1s-.3333.6667-.5 1c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5l-2 2-2 2c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5c.3333-.6667.6667-1.3333 1-2s.6667-1.3333 1-2l1 1 1 1c1-1.1667 2-2.3333 3-3.5 2-2.3333 4.6667-3.6667 8-4s6.6667-1.3333 10-3 5.3333-2.3333 6-2m26 4c-.333 1.5-.667 3-1 4.5.5-.6667 1-1.3333 1.5-2 1-1.3333 1.333-2.8333 1-4.5-.167-.8333-.333-1.6667-.5-2.5-.333 1.5-.667 3-1 4.5m-88.5-1c-1 1-1.3333 2.1667-1 3.5.1667.6667.3333 1.3333.5 2 1.3333-.6667 2.6667-1.3333 4-2s2.6667-1.3333 4-2c-1 .3333-2 .6667-3 1s-2 .6667-3 1c.3333-.6667.6667-1.3333 1-2s.6667-1.3333 1-2c-.3333-.1667-.6667-.3333-1-.5-.6667-.3333-1.5 0-2.5 1M57 82l1 1 1 1-1-1zm-8 4c1.3333.6667 2.1667 1.6667 2.5 3 .1667.6667.3333 1.3333.5 2h-4.5c-3 0-5.1667.6667-6.5 2l-2 2c1.3333-1.6667 2.6667-3.3333 4-5 2.6667-3.3333 4.6667-4.6667 6-4m-26 0c.3333.1667.6667.3333 1 .5s.6667.3333 1 .5c-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5m51 0h1c-.1667.5-.3333 1-.5 1.5s-.3333 1-.5 1.5c-.3333-.1667-.6667-.3333-1-.5s-.6667-.3333-1-.5c.1667-.3333.3333-.6667.5-1 .3333-.6667.8333-1 1.5-1m19.5 1c.1667.3333.3333.6667.5 1-.1667-.3333-.3333-.6667-.5-1s-.3333-.6667-.5-1c.1667.3333.3333.6667.5 1M45 89.5c-.3333.5-.6667 1-1 1.5.3333-.5.6667-1 1-1.5s.6667-1 1-1.5c-.3333.5-.6667 1-1 1.5m52 2c.3333.8333.6667 1.6667 1 2.5-1-.1667-2-.3333-3-.5-2-.3333-3.8333 0-5.5 1S86 96 84 96h-3c.8333-.3333 1.6667-.6667 2.5-1 1.6667-.6667 2.5-1.3333 2.5-2s1.6667-1.5 5-2.5 5.3333-.6667 6 1M96 96c2.6667.6667 4.333 2.3333 5 5 .333 1.333.667 2.667 1 4l-3-3c-2-2-4-3.3333-6-4-1-.3333-2-.6667-3-1l1-1c.6667-.6667 2.3333-.6667 5 0m-40 1 1 1 1 1-1-1zm11 1c.5.1667 1 .3333 1.5.5s1 .3333 1.5.5c-.5.1667-1 .3333-1.5.5s-1 .3333-1.5.5zm-2 1c.1667.3333.3333.6667.5 1 .1667.333.3333.667.5 1-.1667-.333-.3333-.667-.5-1-.1667-.3333-.3333-.6667-.5-1m-33 3c.1667.667.3333 1.333.5 2s.3333 1.333.5 2c.5-.333 1-.667 1.5-1s1-.667 1.5-1c.6667 3.333 1.3333 6.667 2 10s1.3333 6.667 2 10c-1.3333-2.667-2.6667-5.333-4-8-2.6667-5.333-4-9-4-11zm65 2c.5.667 1 1.333 1.5 2 1 1.333.8333 2.667-.5 4-.6667.667-1.3333 1.333-2 2-.1667-1-.3333-2-.5-3-.3333-2-.1667-3.333.5-4 .3333-.333.6667-.667 1-1m29 4c.333.667.667 1.333 1 2-.333-.667-.667-1.333-1-2s-.667-1.333-1-2c.333.667.667 1.333 1 2m-43 0c1 .167 2 .333 3 .5s2 .333 3 .5c-.6667.167-1.3333.333-2 .5-1.3333.333-2.3333.167-3-.5-.3333-.333-.6667-.667-1-1m26 6c.167.333.333.667.5 1s.333.667.5 1c-.167-.333-.333-.667-.5-1s-.333-.667-.5-1m2 1c.667.167 1.333.333 2 .5s1.333.333 2 .5c-.667-.167-1.333-.333-2-.5s-1.333-.333-2-.5m-1 2h6.5c4.333 0 7 .333 8 1 .5.333 1 .667 1.5 1-2.333.333-4.667.667-7 1-4.667.667-7.333.333-8-1-.333-.667-.667-1.333-1-2m-31 2c.3333.167.6667.333 1 .5s.6667.333 1 .5c-.3333-.167-.6667-.333-1-.5s-.6667-.333-1-.5m15 0c.8333.333 1.6667.667 2.5 1s1.6667.667 2.5 1c-.5.833-1 1.667-1.5 2.5s-1 1.667-1.5 2.5c-.3333-1.167-.6667-2.333-1-3.5s-.6667-2.333-1-3.5m-26 7c.6667 1.333 1.5 2 2.5 2H72c-.8333-.667-1.6667-1.333-2.5-2s-1.6667-1.333-2.5-2c.3333.667.6667 1.333 1 2"/>
  </svg>

  <!-- 主标题 -->
  <text x="70" y="32" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f5576c">
    心动点赞 · Heartfelt
  </text>

  <!-- 点赞次数 -->
  <text x="70" y="50" font-family="Arial, sans-serif" font-size="14" fill="#f5576c">
    ${count} 次点赞 · ${count} likes
  </text>

  <!-- 副标题 -->
  <text x="70" y="68" font-family="Arial, sans-serif" font-size="11" fill="#999">
    最近记录 · Recent records
  </text>

  <!-- 分隔线 -->
  <line x1="20" y1="80" x2="360" y2="80" stroke="#f5576c" stroke-width="1" stroke-dasharray="5,5"/>

${likeLines}
</svg>`;
}

export function renderLikeButton(namespace: string, key: string, count: number): string {
  const likeUrl = `${BASE_URL}/v1/like/${namespace}/${key}/add`;

  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="780" height="60" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="likeBtnBg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.15" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:0.15" />
    </linearGradient>
  </defs>

  <!-- 可点击区域 -->
  <a href="${likeUrl}">
    <!-- 背景按钮 -->
    <rect x="0" y="0" width="780" height="60" rx="10" fill="url(#likeBtnBg)" stroke="#f5576c" stroke-width="2" style="cursor:pointer"/>

    <!-- 爱心图标 -->
    <text x="30" y="42" font-size="28" fill="#f5576c">❤️</text>

    <!-- 主文字 -->
    <text x="75" y="28" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f5576c">
      给我点赞 · Give a Like
    </text>

    <!-- 当前点赞数 -->
    <text x="75" y="48" font-family="Arial, sans-serif" font-size="12" fill="#999">
      已有 ${count} 人点赞 · ${count} likes
    </text>

    <!-- 右侧提示文字 -->
    <text x="630" y="38" font-family="Arial, sans-serif" font-size="14" fill="#f5576c" style="cursor:pointer">
      点击 · Click →
    </text>
  </a>
</svg>`;
}

// 推广徽章 - 推荐 Visitor Badge 项目
export function renderPromoButton(repoUrl: string = "https://github.com/ailuntz/ailuntz"): string {
  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="780" height="60" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="promoBg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.15" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.15" />
    </linearGradient>
  </defs>

  <!-- 可点击区域 -->
  <a href="${repoUrl}">
    <!-- 背景按钮 -->
    <rect x="0" y="0" width="780" height="60" rx="10" fill="url(#promoBg)" stroke="#667eea" stroke-width="2" style="cursor:pointer"/>

    <!-- 图标 -->
    <text x="30" y="42" font-size="28" fill="#667eea">⭐</text>

    <!-- 主文字 -->
    <text x="75" y="28" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#667eea">
      Powered by Visitor Badge
    </text>

    <!-- 副文字 -->
    <text x="75" y="48" font-family="Arial, sans-serif" font-size="12" fill="#999">
      轻量级访客统计徽章 · Lightweight visitor tracking
    </text>

    <!-- 右侧提示文字 -->
    <text x="590" y="38" font-family="Arial, sans-serif" font-size="14" fill="#667eea" style="cursor:pointer">
      查看项目 · View →
    </text>
  </a>
</svg>`;
}
